# using docker container
sudo: false

language: android

jdk:
  - oraclejdk8

android:
  components:
    - tools
    - platform-tools
    - tools

    - build-tools-26.0.0

    - android-22
    - android-25
    - sys-img-armeabi-v7a-android-22

    - extra-android-support
    - extra-android-m2repository

before_script:
   - android list targets
   - echo no | android create avd --force -n test -t android-22 --abi armeabi-v7a
   - emulator -avd test -no-audio -no-window &
   - android-wait-for-emulator
   - adb shell input keyevent 82 &

script:
  - ./gradlew :library:createDebugAndroidTestCoverageReport --info --stacktrace
  - ./gradlew clean build

dist:
  - trusty

after_success:
  - bash <(curl -s https://codecov.io/bash)

after_failure:
  - if [ -f /home/travis/build/pre-dem/pre-dem-android/example/build/reports/lint-results.html ]; then lynx -dump /home/travis/build/pre-dem/pre-dem-android/example/build/reports/lint-results.html; fi

before_install:
- gem install fir-cli
after_deploy:
- fir p example/build/outputs/apk/example-release.apk -T $FIR_TOKEN -c "`git cat-file tag $TRAVIS_TAG`"

notifications:
  email:
  - liangmengmeng@qiniu.com