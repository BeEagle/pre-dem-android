# using docker container
sudo: false

language: android

jdk:
  - oraclejdk8

android:
  components:
    - tools
    - platform-tools
    - tools

    - build-tools-26.0.0

    - android-22
    - android-25
    - sys-img-armeabi-v7a-android-22

    - extra-android-support
    - extra-android-m2repository

before_script:
   - android list targets
   - echo no | android create avd --force -n test -t android-22 --abi armeabi-v7a
   - emulator -avd test -no-audio -no-window &
   - android-wait-for-emulator
   - adb shell input keyevent 82 &

script:
  - ./gradlew :library:createDebugAndroidTestCoverageReport --info --stacktrace
  - ./gradlew build

dist:
  - trusty

after_success:
  - bash <(curl -s https://codecov.io/bash)

after_failure:
  - if [ -f /home/travis/build/pre-dem/pre-dem-android/example/build/reports/lint-results.html ]; then lynx -dump /home/travis/build/pre-dem/pre-dem-android/example/build/reports/lint-results.html; fi

deploy:
  provider: releases
  api_key:
    secure: X3E3WcHEn0GqUbGbfRfxSJcIbygPwRK76QdKuNU+3XJOUQb+i+GUw4BSxT7Ucw1hby0LQS8PuRtW2zkQAH6RwV0G+q9gL9od1n7W8YAuaFJqTNCQaXTzRsbv/3XEPUl39GgkYsAEdn45sFL28TzxgPOnUWI6WYDJHufqIlqaSNLYcRUtl8biuROEh6GlNdamAe2SrQNooK8g6DwS0Mkjsflc1fy9DF7fNvu9ilG5xxN6vxv/QKcErTDUCuxXoGiUZeRtR5a3NK5m0tQDgGCPfIIy/bI87E1nARHtctkb+8axle17VlWgzkLxVwqwzYQ9GiSYx9x06Vjh5kftBCsl+3yIkcVbum04tH/6q0tSNIMv2f+lWVp5d8g0b3q1yqQWV0GAcnlWYkm5fv18oBqTiKScb4hwhyllZF/CdSzbmxa8A+AvPTJFB9pr+I9jtW8FcgYZSUCbgbTeA7Gtcbxc+g52e9nkQTSpyydHLa9E3NYY2GGWpIY/cdeXdztEH47e/vIq/an3eHnw51SXOd9w09xjTai4hpRT5b+kOLAIutvm6UFjqvrpsGKlBxWi0TWB+PUmhDOCZHczVnLR/he7+GNafOrR4PDM1LYkGPntLIStDGujI9JK7xC7v6iZ/6rtkjLvZwVvfuE+sBI+01fp63UIoSCKcg7vW6//TdSrCNI=
  skip_cleanup: true
  on:
    repo: pre-dem/pre-dem-android
before_install:
- gem install fir-cli
after_deploy:
- fir p example/build/outputs/apk/example-release.apk -T $FIR_TOKEN -c "`git cat-file tag $TRAVIS_TAG`"

notifications:
  email:
  - liangmengmeng@qiniu.com